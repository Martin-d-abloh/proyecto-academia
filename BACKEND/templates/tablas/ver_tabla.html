{% extends "base.html" %}
{% block content %}
<h1>{{ tabla.nombre }}</h1>

<!-- Bot√≥n para crear nuevo alumno -->
<a href="{{ url_for('crear_alumno', id_tabla=tabla.id) }}">
    <button>Crear nuevo alumno</button>
</a>

<h2>Alumnos:</h2>

{% if tabla.alumnos %}
    <table border="1" cellpadding="6" cellspacing="0">
        <thead>
            <tr>
                <th>Nombre</th>
                {% for doc in tabla.documentos if doc.alumno_id is none %}
                    <th>
                        {{ doc.nombre }}
                        <!-- Bot√≥n de eliminar documento -->
                        <form method="POST" action="{{ url_for('eliminar_documento_tabla_id', id_tabla=tabla.id, doc_id=doc.id) }}" style="margin-top: 5px;">
                            <button type="submit" style="font-size: 10px;" onclick="return confirm('¬øEliminar este documento de toda la tabla?')">üóëÔ∏è</button>
                        </form>
                    </th>
                {% endfor %}
                <th>Estado general</th>
                <th>Link √∫nico</th>
                <th>Eliminar</th>
            </tr>
        </thead>
        <tbody>
            {% for alumno in tabla.alumnos %}
                <tr>
                    <td>{{ alumno.nombre }} {{ alumno.apellidos }}</td>
                    {% for doc in tabla.documentos if doc.alumno_id is none %}
                        {% set doc_subido = alumno.documentos | selectattr('nombre', 'equalto', doc.nombre) | first %}
                        <td>
                            {% if doc_subido %}
                                {% if doc_subido.estado == 'aceptado' %}
                                    ‚úÖ Validado
                                {% elif doc_subido.estado == 'subido' %}
                                    ‚úÖ Subido
                                {% else %}
                                    ‚ùå Rechazado
                                {% endif %}
                                <br>
                                <a href="{{ url_for('descargar_documento', doc_id=doc_subido.id) }}">üì• Descargar</a>
                            {% else %}
                                ‚ùå No entregado
                            {% endif %}
                        </td>
                    {% endfor %}
                    <td>
                        {% if alumno.documentos | selectattr('alumno_id', 'equalto', alumno.id) | list | length >= tabla.documentos | selectattr('alumno_id', 'equalto', None) | list | length %}
                            ‚úÖ
                        {% else %}
                            ‚ùå
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('ver_alumno', alumno_id=alumno.id) }}">Acceder</a>
                    </td>
                    <td>
                        <form method="POST" action="{{ url_for('eliminar_alumno', id_tabla=tabla.id, alumno_id=alumno.id) }}">
                            <button type="submit" onclick="return confirm('¬øEliminar este alumno?')">üóëÔ∏è</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Formulario para a√±adir nuevo documento -->
    <h3>A√±adir nuevo documento a esta tabla:</h3>
    <form method="POST" action="{{ url_for('a√±adir_documento', id_tabla=tabla.id) }}">
        <input type="text" name="nuevo_documento" placeholder="Nombre del nuevo documento" required>
        <button type="submit">A√±adir documento</button>
    </form>
{% else %}
    <p>No hay alumnos registrados.</p>
{% endif %}
{% endblock %}
